<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>لوحة المدير - نظام الدور</title>
  <link rel="stylesheet" href="./styles.css?v=24"/>
</head>
<body>
  <div class="container">
    <div class="top">
      <h1>لوحة المدير</h1>
      <p>الفرع + الحماية (PIN) ثم تظهر بقية الإعدادات بعد إدخال رقم المدير</p>
    </div>

    <div class="subbar">
      <a class="pill" href="./index.html?branch=">الصفحة الرئيسية</a>
      <span class="pill">الحالة: <b id="conn">غير متصل...</b></span>
      <button class="pill" id="fsBtn" type="button">ملء الشاشة ⛶</button>
    </div>

    <div class="adminTopGrid">
      <div class="card">
        <div class="hd">الفرع</div>
        <div class="bd">
          <label>الفرع</label>
          <select id="branchSelect"></select>
          <button class="btn" id="setBranch" style="margin-top:10px">تغيير الفرع</button>
          <small class="help">انسخ نفس الفرع إلى شاشة العرض والموظف.</small>
        </div>
      </div>

      <div class="card">
        <div class="hd">الحماية (PIN)</div>
        <div class="bd">
          <label>رقم المدير (Admin PIN)</label>
          <input id="adminPin" inputmode="numeric" placeholder="اكتب رقم المدير"/>
          <div class="btns" style="margin-top:10px">
            <button class="primary" id="saveAdminPin">فتح / حفظ رقم المدير</button>
            <button class="danger" id="resetAdminPin">إعادة تعيين رقم المدير</button>
          </div>
          <small class="help">بعد إدخال الرقم الصحيح ستظهر باقي الأقسام تلقائيًا.</small>
          <div id="msg" class="msg" style="margin-top:10px"></div>
        </div>
      </div>
    </div>

    <div id="adminPrivate" class="adminPrivate isLocked">
      <div class="adminPrivateGrid">
        <div class="card">
          <div class="hd">إعدادات النظام</div>
          <div class="bd">
            <label>اسم الجهة</label>
            <input id="instituteName" placeholder="معهد السلامة المرورية"/>
            <label style="margin-top:10px">عدد الأرقام المحفوظة في السجل</label>
            <input id="historyLimit" type="number" min="3" max="60" value="15"/>
            <label style="margin-top:10px">النص السفلي</label>
            <input id="tickerText" placeholder="يرجى الالتزام بالهدوء..."/>
            <div class="btns" style="margin-top:10px">
              <button class="primary" id="saveSettings">حفظ الإعدادات</button>
              <button class="warn" id="resetAll">تصفير النظام بالكامل</button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="hd">الصورة في العمود الأوسط</div>
          <div class="bd">
            <label>اختر صورة (PNG/JPG)</label>
            <input id="centerImg" type="file" accept="image/png,image/jpeg"/>
            <div id="centerImgWrap" class="imgWrap"></div>
          </div>
        </div>

        <div class="card">
          <div class="hd">الملاحظة (صلاحية المدير فقط)</div>
          <div class="bd">
            <label>نص الملاحظة</label>
            <textarea id="adminNote" rows="5" placeholder="اكتب ملاحظة تظهر في شاشة العرض..."></textarea>
            <div class="btns" style="margin-top:10px">
              <button class="primary" id="saveAdminNote">حفظ الملاحظة</button>
            </div>
          </div>
        </div>

        <div class="card adminStaffCard">
          <div class="hd">إدارة الموظفين + نطاقاتهم</div>
          <div class="bd">
            <label>اسم المستخدم الجديد</label>
            <input id="newUsername" placeholder="مثال: أحمد"/>
            <label style="margin-top:10px">رقم الموظف (PIN)</label>
            <input id="newUserPin" inputmode="numeric" placeholder="مثال: 4321"/>
            <div class="btns" style="margin-top:10px">
              <button class="primary" id="addStaff">إضافة موظف</button>
            </div>
            <hr style="margin:12px 0;opacity:.25"/>
            <div id="staffList" class="staffListGrid"></div>
            <small class="help">يمكنك تحديد (من/إلى) لكل موظف + حفظ.</small>
          </div>
        </div>

        <div class="card">
          <div class="hd">دردشة المدير مع الموظفين</div>
          <div class="bd">
            <label>اختر موظف</label>
            <select id="chatUserSelect"></select>
            <div class="chatBox" id="chatListAdmin"></div>
            <div class="row" style="margin-top:10px;display:flex;gap:8px">
              <input id="chatTextAdmin" placeholder="اكتب رسالة..." style="flex:1"/>
              <button class="primary" id="sendChatAdmin">إرسال</button>
            </div>
            <div class="btns" style="margin-top:10px">
              <button class="danger" id="clearChatAdmin">مسح الدردشة</button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="rights">جميع الحقوق محفوظة — الرقيب أول يحيى آل عبدالسلام</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <script src="./app.js?v=24"></script>
  <script>window.TQ && window.TQ.initAdmin && window.TQ.initAdmin();</script>
  <script>
    document.getElementById('fsBtn')?.addEventListener('click', ()=>{
      const el = document.documentElement;
      if(!document.fullscreenElement) el.requestFullscreen?.();
      else document.exitFullscreen?.();
    });
  </script>
</body>
</html>
