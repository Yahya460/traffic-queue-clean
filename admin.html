<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>لوحة المدير - نظام الدور</title>
  <link rel="stylesheet" href="./styles.css?v=gold"/>
</head>

<body>
  <div class="container">

    <!-- العنوان -->
    <div class="top">
      <h1>لوحة المدير</h1>
      <p>إعدادات النظام • رقم المدير • إدارة الموظفين • التصفير • الإحصائيات</p>
    </div>

    <!-- الشريط العلوي -->
    <div class="subbar">
      <button class="btn mini" id="fsBtn">⛶ ملء الشاشة</button>
      <div class="pill">الحالة: <b id="conn">غير متصل…</b></div>
      <div class="pill" id="msg">جاهز</div>
    </div>

    <!-- الصف الأول -->
    <div class="cardRow">

      <!-- الفرع -->
      <div class="card">
        <div class="hd">الفرع</div>
        <div class="bd">
          <label>اختر الفرع</label>
          <select id="branchSelect">
            <option value="SOHAR">Sohar</option>
            <option value="MUSCAT">Muscat</option>
            <option value="NIZWA">Nizwa</option>
            <option value="IBRI">Ibri</option>
            <option value="IBRA">Ibra</option>
            <option value="SUR">Sur</option>
            <option value="HAIMA">Haima</option>
            <option value="SALALAH">Salalah</option>
            <option value="BURAIMI">Buraimi</option>
            <option value="MUSANDAM">Musandam</option>
            <option value="RUSTAQ">Rustaq</option>
          </select>
          <div class="btns">
            <button class="gray" id="setBranch">تغيير الفرع</button>
          </div>
          <small class="help">يجب أن يكون نفس الفرع في شاشة الموظف والعرض</small>
        </div>
      </div>

      <!-- رقم المدير -->
      <div class="card">
        <div class="hd">الحماية (PIN)</div>
        <div class="bd">
          <label>رقم المدير</label>
          <input id="adminPin" type="password" placeholder="مثال: 1234"/>
          <small class="help">يُستخدم لجميع عمليات التعديل والتصفير</small>
        </div>
      </div>

      <!-- إعدادات النظام -->
      <div class="card">
        <div class="hd">إعدادات النظام</div>
        <div class="bd">
          <label>اسم الجهة</label>
          <input id="instituteName" placeholder="معهد السلامة المرورية"/>

          <label style="margin-top:10px">عدد الأرقام المحفوظة</label>
          <input id="historyLimit" type="number" min="3" max="60"/>

          <label style="margin-top:10px;display:flex;gap:8px;align-items:center">
            <input type="checkbox" id="autoDailyReset"/>
            <span>تصفير تلقائي نهاية اليوم</span>
          </label>

          <label style="margin-top:10px">النص السفلي</label>
          <input id="tickerText" placeholder="يرجى الالتزام بالهدوء وانتظار دوركم"/>

          <div class="btns">
            <button class="primary" id="saveSettings">حفظ الإعدادات</button>
          </div>
        </div>
      </div>

    </div>

    <!-- الصف الثاني -->
    <div class="cardRow">

      <!-- الملاحظة -->
      <div class="card">
        <div class="hd">الملاحظة (لشاشة العرض)</div>
        <div class="bd">
          <textarea id="adminNote" placeholder="مثال: يرجى التوجه لغرفة التجهيز"></textarea>
          <div class="btns">
            <button class="primary" id="saveAdminNote">حفظ الملاحظة</button>
          </div>
        </div>
      </div>

      <!-- التصفير -->
      <div class="card">
        <div class="hd">تصفير النداءات (حسب الفرع)</div>
        <div class="bd">
          <div class="btns">
            <button class="warn" id="resetCallsMen">تصفير نداءات الرجال</button>
            <button class="warn" id="resetCallsWomen">تصفير نداءات النساء</button>
            <button class="danger" id="resetAll">تصفير كامل (النداءات + الرقم)</button>
          </div>

          <div class="splitLine"></div>
          <div class="hint">
            إحصائيات اليوم:
            <br>
            التاريخ: <b id="statsDate">—</b><br>
            رجال: <b id="statsMen">0</b> |
            نساء: <b id="statsWomen">0</b> |
            الإجمالي: <b id="statsTotal">0</b>
          </div>
        </div>
      </div>

      <!-- الموظفين -->
      <div class="card">
        <div class="hd">إدارة الموظفين</div>
        <div class="bd">
          <label>اسم الموظف</label>
          <input id="newUsername" placeholder="مثال: يوسف"/>

          <label style="margin-top:10px">رقم الموظف</label>
          <input id="newUserPin" type="password" placeholder="مثال: 4321"/>

          <div class="btns">
            <button class="primary" id="addStaff">إضافة موظف</button>
          </div>

          <div id="staffList" style="margin-top:12px"></div>
        </div>
      </div>

    </div>

    <!-- الحقوق -->
    <div class="rights">
      جميع الحقوق محفوظة — الرقيب أول يحيى آل عبدالسلام
    </div>

  </div>

  <!-- السكربتات -->
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <script src="./app.js?v=gold"></script>
  <script>
    initAdmin();
  </script>

  <script>
    function toggleFullscreen(){
      try{
        if(!document.fullscreenElement){
          document.documentElement.requestFullscreen();
        }else{
          document.exitFullscreen();
        }
      }catch(e){}
    }
    document.addEventListener("DOMContentLoaded", ()=>{
      const b = document.getElementById("fsBtn");
      if(b) b.onclick = toggleFullscreen;
    });
  </script>

</body>
</html>
